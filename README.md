
# MCP服务端：代码分析系统



## 一、项目概述
模型上下文协议（Model Context Protocol，MCP），是由 Anthropic推出的开源协议 ，模型上下文协议是专为高效获得模型所需要上下文信息而设计的通用接口，本项目是基于 Python 开发的开源代码分析工具，由mcp方式提供服务，专注于 GitLab 合并请求（Merge Request）的自动化分析。通过集成 DeepSeek 智能分析引擎，实现对合并分支代码的多维度指标评估，并通过钉钉群推送专业分析报告。核心功能包括：

## 二、功能

- 服务提供方式
  - mcp
- 代码获取
  - 自动拉取 GitLab 合并请求代码
- 模型支持
  - 支持 DeepSeek。
- 消息推送
  - 代码审查结果生成报告发送钉钉群。
  
  
## 三、评分标准体系
### 1. 核心评分维度
| 维度 | 分值 | 评估内容 |
|------|------|----------|
| 功能实现的正确性与健壮性 | 40分 | 代码逻辑正确性、边界条件处理、异常捕获与处理 |
| 安全性与潜在风险 | 30分 | 安全漏洞检测、敏感信息处理、输入验证 |
| 是否符合最佳实践 | 20分 | 代码结构合理性、命名规范、注释质量、模块化程度 |
| 性能与资源利用效率 | 5分 | 算法复杂度、内存/CPU使用效率、IO操作优化 |
| Commits信息的清晰性与准确性 | 5分 | 提交信息规范度、变更说明清晰度 |

### 2. 评分细则示例
#### 功能实现的正确性与健壮性(40分)
- 核心功能完整实现(15分)
- 边界条件处理(10分)
- 异常处理机制(10分)
- 单元测试覆盖率(5分)

#### 安全性与潜在风险(30分)
- SQL注入防护(7分)
- XSS防护(7分)
- 敏感信息处理(6分)
- 输入验证(5分)
- 权限控制(5分)


## 四、分析报告示例
```markdown
# 代码分析报告 - 项目ID:12345/MR:678

## 问题描述和优化建议
1. **安全风险**
   - 问题：发现SQL注入风险点(2处)
   - 建议：使用参数化查询替代字符串拼接

2. **最佳实践**
   - 问题：部分函数缺少类型注解(5处)
   - 建议：添加函数参数和返回值类型注解

3. **性能问题**
   - 问题：存在低效的列表操作(1处)
   - 建议：使用生成器替代大列表

## 评分明细
| 维度 | 分数 | 详细说明 |
|------|------|----------|
| 功能实现的正确性与健壮性 | 35/40 | 核心功能完整，但缺少部分边界条件处理 |
| 安全性与潜在风险 | 22/30 | 存在SQL注入和敏感信息处理问题 |
| 是否符合最佳实践 | 16/20 | 命名规范较好，但类型注解缺失 |
| 性能与资源利用效率 | 3/5 | 存在一处明显的性能优化点 |
| Commits信息的清晰性与准确性 | 4/5 | 提交信息基本规范 |

## 总分
总分:80分
```

## 五、启动配置

在conf/.env配置文件中配置如下信息：
```
DEEPSEEK_API_KEY=xxx
DEEPSEEK_API_BASE_URL=http://deepseek
DEEPSEEK_API_MODEL=DeepSeek-V3

GITLAB_URL=https://gitlab.com
GITLAB_ACCESS_TOKEN=xxx

LOG_FILE=log/app.log
LOG_MAX_BYTES=10485760
LOG_BACKUP_COUNT=3
LOG_LEVEL=DEBUG
```
然后使用python server.py启动服务，启动后会显示端口，在mcp客户端配置上如下内容即可调用本服务：
```
{
	"mcpServers": {
		"remote-server": {
			"url": "https://xxx.com/sse"
		}
	}
}
```
